
<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Andre Brutus - Blog</title>
  <meta name="author" content="Andre Brutus">
  <meta name="google-site-verification" content="mRTgsVG1EorsoR2e5W1z4JNzankQ9HVxtN6b0Xgtkgs" />
  
  <meta name="description" content="Top 10 Ips in Nginx Access Log Feb 17th, 2014 This is an useful query for when you are getting hammered by scripts/bots. I will likely use it again &hellip;">
  
  

  <link rel="canonical" href="http://abrut.us">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Andre Brutus" type="application/atom+xml">
	 
  <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "ea62dc43-089f-4fac-9d53-8bca45d3c87d"}); </script>
</head>
  
<body class="default">
  <div id="wrapper">
    <div id="header">
  <h1><a href="/">Andre Brutus</a></h1>
  
    <p>pipe it into vim -</p>
  
</div>
<ul id="social-links">
  
    <li><a class="feed" href="/atom.xml" title="RSS">RSS</a></li>
  
  
	<li><a class="twitter" href="http://twitter.com/anebg" title="Twitter">Twitter</a></li>  
  
  
    <li> <a class="github" href="https://github.com/abrutus" title="GitHub">GitHub</a> </li>
  
</ul>
<div class="clear"></div>
<ul id="nav">
  
    <li> <a href="/" class="current">blog</a> </li>
  

  
    <li><a href="/blog/archives">archives</a></li>
  
</ul>

    <div id="main"> 

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2014/02/17/top-10-ips-in-nginx-access-log/">Top 10 Ips in Nginx Access Log</a>
    </h1>
  
  








  


<time datetime="2014-02-17T12:57:00-08:00" pubdate data-updated="true">Feb 17<span>th</span>, 2014</time>
</div>

<div class="post-content"><p>This is an useful query for when you are getting hammered by scripts/bots. I will likely use it again, so here it goes.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cut -d ' ' -f1 /var/log/nginx/nginx-access.log | sort | uniq -c | sort -nr | head -10 | nl</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.commandlinefu.com/commands/view/290/see-the-top-10-ip-addresses-in-a-web-access-log">source</a></p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2013/09/25/env-python2-no-such-file-or-directory/">Env: Python2: No Such File or Directory</a>
    </h1>
  
  








  


<time datetime="2013-09-25T16:29:00-07:00" pubdate data-updated="true">Sep 25<span>th</span>, 2013</time>
</div>

<div class="post-content"><p>Tried out asciinema and encountered the <code>env: python2: No such file or directory</code> error. Asciinema must be attempting to use python from the wrong symlink. To create it,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ln -s /usr/bin/python /usr/bin/python2</span></code></pre></td></tr></table></div></figure>


<p>(assuming /usr/bin/python is python 2.x). If you dont know where python and it is not located in /usr/bin/python, run <code>which python</code>. To find out which python you have, run <code>python --version</code>. Combining both commands, you could run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ln -s `which python` /usr/bin/python2</span></code></pre></td></tr></table></div></figure>

</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2013/09/25/how-to-reset-stats-rrdb/">How to Reset Stats-rrdb</a>
    </h1>
  
  








  


<time datetime="2013-09-25T10:38:00-07:00" pubdate data-updated="true">Sep 25<span>th</span>, 2013</time>
</div>

<div class="post-content"><p>For some odd reason, I was unable to start the stats-rrdb daemon (it said that it started but it would die immediately afterwards).</p>

<p>After tailing the logs, I found this slightly cryptic error message.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Server status update thread exception: Unexpected rrdb metric block pos 648 pos_ts: 1379698992 (expected from tuple: 1379697192)</span></code></pre></td></tr></table></div></figure>


<p>I attempted changing some configs to no avail, so the last resource was to reset the metrics. Given that this was on my VM and no important metrics were being recorded for me, I resorted to clearing all the data (<strong>don&#8217;t do this in your production environment, unless you don&#8217;t care about losing all your data</strong>).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo rm -rf /var/stats-rrdb/*</span></code></pre></td></tr></table></div></figure>


<p>After clearing all the data, I was able to restart the stats-rrdb. Best of luck!</p>
</div>
 </div>


<div id="pagination">
  
    <a class="prev" href="/blog/page/2/">&laquo;Previous</a>
  
  
</div>
 </div>
    <div id="footer">
  <div class="panels">
    <div class="license">
      <h2>License</h2>
	<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a></p>    
</div>

    <div class="posts">
      <h2>Recent Posts</h2>
      <ul>
        
          <li>
            <a href="/blog/2014/02/17/top-10-ips-in-nginx-access-log/">Top 10 Ips in Nginx access log</a>
          </li>
        
          <li>
            <a href="/blog/2013/09/25/env-python2-no-such-file-or-directory/">env: python2: No such file or directory</a>
          </li>
        
          <li>
            <a href="/blog/2013/09/25/how-to-reset-stats-rrdb/">How to reset stats-rrdb</a>
          </li>
        
          <li>
            <a href="/blog/2012/11/20/301-redirects-with-octopress-on-heroku/">301 Redirects with Octopress on Heroku</a>
          </li>
        
          <li>
            <a href="/blog/2012/11/19/curl-put-request-with-p12-pkcs-number-12-certificate-using-php/">cURL PUT request with P12 (PKCS #12) certificate using PHP</a>
          </li>
        
      </ul>
    </div>

<!--    <div class="douban">
      <h2>Reading</h2>
      
        <p>Please set your Douban ID in _config.yml</p>
      
    </div> -->
  </div>

  <p class="powered">
  Powered  <a href="http://octopress.org">Octopress</a> |  <a href="https://github.com/iwinux/compbits">Compbits</a> | <a href="https://plus.google.com/115128740849046971799?rel=author">My Google+</a>
  </p>
</div>

  </div> <!-- #wrapper end -->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32854946-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  

<script type="text/javascript">
      var disqus_shortname = 'abrutuss';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


  

  

  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
